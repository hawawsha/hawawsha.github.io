<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تنظيف العمليات المعلقة</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
    <div style="text-align:center; padding-top:50px;">
        <h2>جاري تنظيف العمليات السابقة...</h2>
        <p id="status">يرجى الانتظار ثوانٍ داخل Pi Browser</p>
    </div>

    <script>
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: false });

        async function cleanPayments() {
            const statusBox = document.getElementById('status');
            try {
                // محاولة جلب أي دفع معلق لإكماله
                await Pi.authenticate(['payments']);
                statusBox.innerText = "تم الاتصال.. جاري التحقق من السجلات.";
                
                // هذه الدالة ستحاول إنهاء أي عملية عالقة تلقائياً
                alert("سيحاول النظام الآن إغلاق العملية المعلقة. إذا نجح، ستتمكن من العودة لصفحة التفعيل.");
            } catch (err) {
                statusBox.innerText = "خطأ: " + err.message;
            }
        }
        cleanPayments();
    </script>
</body>
</html>
