  // كود للتأكد من استجابة الزر فوراً
  document.getElementById('pay-button').addEventListener('click', async function() {
    alert("بدء الاتصال بالمحفظة..."); // تنبيه للتأكد من الاستجابة
    try {
      await Pi.authenticate(['payments']); 
      const payment = await Pi.createPayment({
        amount: 1,
        memo: "الخطوة الأخيرة للنجاح",
        metadata: { productId: "item-10" }
      }, {
        onReadyForServerApproval: (paymentId) => {
          return fetch('/api/index', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId })
          });
        },
        onReadyForServerCompletion: (paymentId, txid) => {
          alert("مبروك! تم النجاح: " + txid);
        },
        onCancel: (paymentId) => { alert("تم إلغاء الدفع"); },
        onError: (error) => { alert("خطأ: " + error.message); }
      });
    } catch (err) {
      alert("يرجى المحاولة مرة ثانية بعد ثوانٍ");
    }
  });
